<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¢ Painel de Informativos - Igreja de Cristo do Centro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c5282, #3182ce);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .admin-info {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-left: 1rem;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .content {
            padding: 2rem;
        }

        .form-section {
            background: #f7fafc;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }

        .form-section h2 {
            color: #2c5282;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(49, 130, 206, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .informativos-list {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .informativo-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .informativo-item:last-child {
            border-bottom: none;
        }

        .informativo-content {
            flex: 1;
        }

        .informativo-tipo {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .tipo-evento { background: #fed7d7; color: #c53030; }
        .tipo-anuncio { background: #bee3f8; color: #2b6cb0; }
        .tipo-aviso { background: #faf089; color: #975a16; }
        .tipo-urgente { background: #fbb6ce; color: #b83280; }

        .informativo-titulo {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .informativo-descricao {
            color: #4a5568;
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .informativo-data {
            font-size: 0.9rem;
            color: #718096;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .informativo-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: #4a5568;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-left: 4px solid;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }

        .notification.success { border-left-color: #48bb78; }
        .notification.error { border-left-color: #f56565; }
        .notification.info { border-left-color: #4299e1; }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-ativo { background: #48bb78; }
        .status-inativo { background: #cbd5e0; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            body { padding: 0.5rem; }
            .header { padding: 1.5rem; }
            .content { padding: 1rem; }
            .form-row { grid-template-columns: 1fr; }
            .informativo-item { flex-direction: column; }
            .informativo-actions { align-self: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="admin-info">
                üë§ <span id="admin-user">Admin</span>
                <a href="admin-dashboard.html" class="logout-btn" style="text-decoration: none; display: inline-block; margin-right: 0.5rem;">üìä Dashboard</a>
                <button onclick="logout()" class="logout-btn">üö™ Sair</button>
            </div>
            <h1>üì¢ Painel de Informativos</h1>
            <p>Gerencie eventos, avisos e an√∫ncios da igreja</p>
        </div>

        <div class="content">
            <!-- Formul√°rio para Adicionar/Editar -->
            <div class="form-section">
                <h2>
                    <span id="form-icon">‚ûï</span>
                    <span id="form-title">Novo Informativo</span>
                </h2>
                
                <form id="informativo-form">
                    <input type="hidden" id="edit-id">
                    
                    <div class="form-group">
                        <label for="tipo">üìã Tipo de Informativo:</label>
                        <select id="tipo" required>
                            <option value="">Selecione o tipo</option>
                            <option value="evento">üéâ Evento</option>
                            <option value="anuncio">üì¢ An√∫ncio</option>
                            <option value="aviso">‚ö†Ô∏è Aviso Importante</option>
                            <option value="urgente">üö® Urgente</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="titulo">üìù T√≠tulo:</label>
                        <input type="text" id="titulo" placeholder="Ex: Culto Especial de A√ß√£o de Gra√ßas" required maxlength="100">
                    </div>

                    <div class="form-group">
                        <label for="descricao">üìÑ Descri√ß√£o:</label>
                        <textarea id="descricao" placeholder="Descri√ß√£o detalhada do informativo..." maxlength="500"></textarea>
                    </div>

                    <!-- NOVOS CAMPOS PARA EVENTOS -->
                    <div class="form-group">
                        <label for="categoria">üéØ Categoria do Evento:</label>
                        <select id="categoria">
                            <option value="eventos">üìÖ Eventos</option>
                            <option value="seminarios">üéì Semin√°rios</option>
                            <option value="avisos">üì¢ Avisos</option>
                            <option value="igrejas_irmas">üèõÔ∏è Igrejas Irm√£s</option>
                            <option value="comemoracoes">üéâ Comemora√ß√µes</option>
                            <option value="cultos_especiais">üôè Cultos Especiais</option>
                        </select>
                        <small>Para p√°gina de Eventos com calend√°rio e mapa</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="data-evento">üìÖ Data do Evento:</label>
                            <input type="date" id="dataEvento">
                            <small>Data para o calend√°rio</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="hora-evento">‚è∞ Hora do Evento:</label>
                            <input type="time" id="horaEvento" value="19:00">
                            <small>Hor√°rio de in√≠cio</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="local-nome">üìç Nome do Local:</label>
                        <input type="text" id="localNome" placeholder="Ex: Igreja de Cristo do Centro" maxlength="100">
                    </div>

                    <div class="form-group">
                        <label for="local-endereco">üó∫Ô∏è Endere√ßo Completo:</label>
                        <input type="text" id="localEndereco" placeholder="Av. Sete de Setembro, 1801 - Centro, Manaus/AM" maxlength="200">
                        <small>Usado para mostrar no mapa Google Maps</small>
                    </div>

                    <div class="form-group">
                        <label for="whatsapp">üí¨ Link WhatsApp (opcional):</label>
                        <input type="url" id="whatsapp" placeholder="https://wa.me/5592991146877?text=Ol√°">
                        <small>Link direto para d√∫vidas/inscri√ß√µes no evento</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="prioridade">‚≠ê Prioridade:</label>
                            <select id="prioridade">
                                <option value="baixa">üü¢ Baixa</option>
                                <option value="media" selected>üü° M√©dia</option>
                                <option value="alta">üî¥ Alta</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="data-expiracao">‚è∞ Expira em:</label>
                            <input type="date" id="data-expiracao">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="ativo">üëÅÔ∏è Status:</label>
                            <select id="ativo">
                                <option value="true" selected>‚úÖ Ativo (vis√≠vel no site)</option>
                                <option value="false">‚ùå Inativo (oculto)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="data-expiracao">‚è∞ Expira em:</label>
                            <input type="date" id="data-expiracao">
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button type="submit" class="btn">
                            <span id="btn-text">üíæ Salvar Informativo</span>
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="cancelarEdicao()">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </form>
            </div>

            <!-- Lista de Informativos -->
            <div class="form-section">
                <h2>üìã Informativos Cadastrados</h2>
                <div id="informativos-list" class="informativos-list">
                    <div class="empty-state">
                        <h3>üì≠ Nenhum informativo cadastrado</h3>
                        <p>Adicione o primeiro informativo usando o formul√°rio acima</p>
                    </div>
                </div>
            </div>

            <!-- Link para o Site -->
            <div style="text-align: center; margin-top: 2rem;">
                <a href="index.html" class="btn">
                    üè† Voltar ao Site
                </a>
                <a href="#" onclick="exportarInformativos()" class="btn btn-secondary">
                    üì§ Exportar Dados
                </a>
            </div>
        </div>
    </div>

    <script>
        // ===== PROTE√á√ÉO DE ACESSO ADMINISTRATIVO =====
        
        // Verificar autentica√ß√£o antes de carregar o painel
        function checkAdminAuth() {
            const session = localStorage.getItem('admin_session');
            
            if (!session) {
                redirectToLogin();
                return false;
            }

            try {
                const data = JSON.parse(session);
                
                // Verificar se a sess√£o n√£o expirou
                if (Date.now() >= data.expires) {
                    localStorage.removeItem('admin_session');
                    alert('Sess√£o expirada. Fa√ßa login novamente.');
                    redirectToLogin();
                    return false;
                }

                // Atualizar informa√ß√µes do usu√°rio logado
                document.getElementById('admin-user').textContent = data.username;
                return true;
                
            } catch (e) {
                localStorage.removeItem('admin_session');
                redirectToLogin();
                return false;
            }
        }

        function redirectToLogin() {
            window.location.href = 'admin-login.html';
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('admin_session');
                redirectToLogin();
            }
        }

        // Verificar autentica√ß√£o antes de executar qualquer c√≥digo
        if (!checkAdminAuth()) {
            // Se n√£o estiver autenticado, n√£o carrega o resto do script
            throw new Error('Acesso negado');
        }

        // ===== SISTEMA DE INFORMATIVOS (s√≥ executa se autenticado) =====
        class InformativosManager {
            constructor() {
                this.informativos = this.carregarInformativos();
                this.renderizar();
            }

            carregarInformativos() {
                const dados = localStorage.getItem('igreja_informativos');
                return dados ? JSON.parse(dados) : [];
            }

            salvarInformativos() {
                localStorage.setItem('igreja_informativos', JSON.stringify(this.informativos));
            }

            adicionarInformativo(dados) {
                const informativo = {
                    id: Date.now(),
                    ...dados,
                    dataCriacao: new Date().toISOString(),
                    ativo: dados.ativo === 'true'
                };
                
                this.informativos.unshift(informativo);
                this.salvarInformativos();
                this.renderizar();
                this.mostrarNotificacao('success', 'Informativo adicionado com sucesso!');
            }

            editarInformativo(id, dados) {
                const index = this.informativos.findIndex(i => i.id == id);
                if (index !== -1) {
                    this.informativos[index] = {
                        ...this.informativos[index],
                        ...dados,
                        ativo: dados.ativo === 'true',
                        dataEdicao: new Date().toISOString()
                    };
                    this.salvarInformativos();
                    this.renderizar();
                    this.mostrarNotificacao('success', 'Informativo atualizado com sucesso!');
                }
            }

            removerInformativo(id) {
                if (confirm('Tem certeza que deseja remover este informativo?')) {
                    this.informativos = this.informativos.filter(i => i.id != id);
                    this.salvarInformativos();
                    this.renderizar();
                    this.mostrarNotificacao('info', 'Informativo removido com sucesso!');
                }
            }

            obterInformativo(id) {
                return this.informativos.find(i => i.id == id);
            }

            renderizar() {
                const container = document.getElementById('informativos-list');
                
                if (this.informativos.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>üì≠ Nenhum informativo cadastrado</h3>
                            <p>Adicione o primeiro informativo usando o formul√°rio acima</p>
                        </div>
                    `;
                    return;
                }

                const html = this.informativos.map(informativo => {
                    const dataEvento = informativo.dataEvento ? 
                        new Date(informativo.dataEvento).toLocaleString('pt-BR') : '';
                    
                    const dataExpiracao = informativo.dataExpiracao ? 
                        new Date(informativo.dataExpiracao).toLocaleDateString('pt-BR') : '';

                    const isExpirado = informativo.dataExpiracao && 
                        new Date(informativo.dataExpiracao) < new Date();

                    return `
                        <div class="informativo-item ${isExpirado ? 'expirado' : ''}">
                            <div class="informativo-content">
                                <div class="informativo-tipo tipo-${informativo.tipo}">
                                    ${this.getTipoLabel(informativo.tipo)}
                                </div>
                                <div class="informativo-titulo">${informativo.titulo}</div>
                                ${informativo.descricao ? `<div class="informativo-descricao">${informativo.descricao}</div>` : ''}
                                <div class="informativo-data">
                                    <span class="status-indicator status-${informativo.ativo ? 'ativo' : 'inativo'}"></span>
                                    ${dataEvento ? `üìÖ ${dataEvento}` : ''}
                                    ${dataExpiracao ? ` | ‚è∞ Expira: ${dataExpiracao}` : ''}
                                    ${isExpirado ? ' | üö´ EXPIRADO' : ''}
                                </div>
                            </div>
                            <div class="informativo-actions">
                                <button class="btn btn-small" onclick="editarInformativo(${informativo.id})">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button class="btn btn-danger btn-small" onclick="manager.removerInformativo(${informativo.id})">
                                    üóëÔ∏è Remover
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            getTipoLabel(tipo) {
                const tipos = {
                    'evento': 'üéâ Evento',
                    'anuncio': 'üì¢ An√∫ncio',
                    'aviso': '‚ö†Ô∏è Aviso',
                    'urgente': 'üö® Urgente'
                };
                return tipos[tipo] || tipo;
            }

            mostrarNotificacao(tipo, mensagem) {
                const notification = document.createElement('div');
                notification.className = `notification ${tipo}`;
                notification.innerHTML = `<strong>${mensagem}</strong>`;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // Inicializar sistema
        const manager = new InformativosManager();

        // Handlers do formul√°rio
        document.getElementById('informativo-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dados = {
                tipo: document.getElementById('tipo').value,
                titulo: document.getElementById('titulo').value,
                descricao: document.getElementById('descricao').value,
                categoria: document.getElementById('categoria').value,
                dataEvento: document.getElementById('dataEvento').value,
                horaEvento: document.getElementById('horaEvento').value,
                local: {
                    nome: document.getElementById('localNome').value,
                    endereco: document.getElementById('localEndereco').value
                },
                whatsapp: document.getElementById('whatsapp').value,
                prioridade: document.getElementById('prioridade').value,
                ativo: document.getElementById('ativo').value,
                dataExpiracao: document.getElementById('data-expiracao').value
            };

            const editId = document.getElementById('edit-id').value;
            
            if (editId) {
                manager.editarInformativo(editId, dados);
                cancelarEdicao();
            } else {
                manager.adicionarInformativo(dados);
                this.reset();
            }
        });

        function editarInformativo(id) {
            const informativo = manager.obterInformativo(id);
            if (!informativo) return;

            // Preencher formul√°rio
            document.getElementById('edit-id').value = id;
            document.getElementById('tipo').value = informativo.tipo;
            document.getElementById('titulo').value = informativo.titulo;
            document.getElementById('descricao').value = informativo.descricao || '';
            document.getElementById('categoria').value = informativo.categoria || 'eventos';
            document.getElementById('dataEvento').value = informativo.dataEvento || '';
            document.getElementById('horaEvento').value = informativo.horaEvento || '19:00';
            document.getElementById('localNome').value = (informativo.local && informativo.local.nome) || '';
            document.getElementById('localEndereco').value = (informativo.local && informativo.local.endereco) || '';
            document.getElementById('whatsapp').value = informativo.whatsapp || '';
            document.getElementById('prioridade').value = informativo.prioridade;
            document.getElementById('ativo').value = informativo.ativo.toString();
            document.getElementById('data-expiracao').value = informativo.dataExpiracao || '';

            // Atualizar UI
            document.getElementById('form-icon').textContent = '‚úèÔ∏è';
            document.getElementById('form-title').textContent = 'Editar Informativo';
            document.getElementById('btn-text').textContent = 'üíæ Atualizar Informativo';

            // Scroll para o formul√°rio
            document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelarEdicao() {
            document.getElementById('informativo-form').reset();
            document.getElementById('edit-id').value = '';
            document.getElementById('form-icon').textContent = '‚ûï';
            document.getElementById('form-title').textContent = 'Novo Informativo';
            document.getElementById('btn-text').textContent = 'üíæ Salvar Informativo';
        }

        function exportarInformativos() {
            const dados = {
                informativos: manager.informativos,
                dataExportacao: new Date().toISOString(),
                versao: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `informativos_igreja_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            manager.mostrarNotificacao('success', 'Dados exportados com sucesso!');
        }

        // Definir data padr√£o como hoje
        document.getElementById('data-evento').value = new Date().toISOString().slice(0, 16);
    </script>
</body>
</html>